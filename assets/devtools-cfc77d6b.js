import{j as m,a as S,c as h,g as v}from"./index-c550fbfb.js";import{e as p}from"./messenger-provider-aedd2154.js";import{i as R}from"./plugins/core/outputs/index-5b646d25.js";import"./preload-helper-75e41364.js";import"./Popover-625761fc.js";window.require=function(e){throw new Error(`Cannot find module '${e}'`)};function g({code:e,lang:s,devtoolsWindow:{simport:r}}){const[o,n]=React.useState(void 0);r("ui/components/code_highlighter/CodeHighlighter.js").then(({highlightNode:i})=>n(()=>i));const t=React.useRef(null);return React.useEffect(()=>{const i=t.current;i&&(i.textContent=e,o==null||o(i,`text/${s}`))},[e,s,o]),m.jsx("pre",{ref:t,style:{cursor:"text",userSelect:"text",whiteSpace:"pre-wrap",margin:"0",padding:"0 4px"}})}let a=[];function W(e){a=e,d.forEach(s=>s(a))}const d=[],$=e=>(d.push(e),p.send("compile"),()=>{const s=d.indexOf(e);d.splice(s,1)});function j(){return React.useSyncExternalStore($,()=>a)}function b({UI:e,devtoolsWindow:{simport:s}}){const r=j(),o=React.useMemo(()=>r.find(({name:t})=>t.endsWith("(compile error)")),[r]),n=React.useMemo(()=>o?r.filter(({name:t})=>t.endsWith("(compile error)")).map(({text:t})=>t).join(`

`):r.filter(({name:t})=>t.endsWith(".js")).map(({name:t,text:i,editorText:l})=>`// @filename:${t}
${l.match(/^\/\/ @devtools.output.compiled\r?\n/)?i:l}`).join(`

`),[o,r]);return m.jsx(g,{code:n,lang:o?"text":"javascript",devtoolsWindow:{simport:s}})}function y({UI:e,devtoolsWindow:{simport:s}}){const r=j();return m.jsx(g,{code:React.useMemo(()=>r.filter(({name:o})=>o.endsWith(".d.ts")).map(({name:o,text:n})=>`// @filename:${o}
${n}`).join(`

`),[r]),lang:"typescript",devtoolsWindow:{simport:s}})}const{babelTransformOptions:C={}}=v(R)??{},F=S({panels:[h("outputs.js",".JS","react",b),h("outputs.d.ts",".D.TS","react",y)],load(){let e;function s(n){const t=e;e=()=>{t==null||t(),n==null||n()}}const r=p.on("run",()=>{a.forEach(({name:n,text:t})=>{if(n==="/index.js")try{e==null||e(),s((0,eval)(`(function () { const module = { exports: {} }; const exports = module.exports; ${t}; return module.exports; })()`).dispose)}catch(i){console.error(i)}})}),o=p.on("compile-completed",n=>{const i=Object.entries(n).reduce((l,[P,{originalText:u,outputFiles:w}])=>l.concat(w.map(({name:c,text:f})=>{var x;if(c.endsWith(".js")){c=c.slice(7);try{return{name:c,text:((x=Babel.transform(f,{presets:["es2015"],...C,filename:c}))==null?void 0:x.code)??"",editorText:u}}catch(E){return{name:`${c} (compile error)`,originalText:f,text:E.message,editorText:u}}}return{name:c,text:f,editorText:u}})),[]);W(i)});return()=>{r==null||r(),o==null||o(),e==null||e()}}});export{F as default};
