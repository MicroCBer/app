import{j as o}from"./index-c550fbfb.js";import{M as w,H as M,f as H,E as S,U as P,F as y,h as I}from"./messenger-provider-aedd2154.js";import{P as L}from"./Popover-625761fc.js";import{u as D}from"./react-cb7e9860.js";import"./copyToClipboard-445aa5b6.js";const z="ppd-left-bar";function k(){return o.jsx("div",{className:z})}function E(...t){return t.filter(e=>e!==void 0&&e!==!1&&e!==null).map(e=>typeof e=="string"?e:Object.entries(e).filter(([,s])=>s).map(([s])=>s).join(" ")).join(" ")}function B(){const{editorInstance:t}=React.useContext(w)??{},[[e,s],i]=React.useState([0,0]);return React.useEffect(()=>{if(!t)return;const r=()=>{const n=t.getPosition();n&&i([n.lineNumber,n.column])};t.onDidChangeCursorPosition(r),r()},[t]),o.jsx(L,{style:{cursor:"pointer"},offset:[0,3],content:"Go to Line and Column",onClick:()=>{t&&(t.focus(),t.trigger("editor","editor.action.quickCommand",{}))},children:o.jsxs("div",{className:"line-and-column",children:[e,":",s]})})}function F(){const t=React.useRef(null);return o.jsxs(o.Fragment,{children:[o.jsx(M,{ref:t}),o.jsx(L,{style:{cursor:"pointer"},offset:[0,3],content:o.jsxs(o.Fragment,{children:["Find Help(",o.jsx("code",{children:"Ctrl"})," + ",o.jsx("code",{children:"/"}),")"]}),onClick:()=>{var e;return(e=t.current)==null?void 0:e.open()},children:o.jsx("div",{className:"cldr codicon codicon-info"})})]})}function T(){const t=React.useRef(null),{editorInstance:e,store:s}=React.useContext(w)??{},[,i]=(s==null?void 0:s.code)??[],[r]=(s==null?void 0:s.theme)??["light"];return React.useEffect(()=>{e&&e.onDidChangeConfiguration(console.log)},[e]),o.jsxs(o.Fragment,{children:[o.jsx(H,{theme:r,ref:t,onChange:n=>i==null?void 0:i(n.code)}),o.jsx(L,{style:{cursor:"pointer"},offset:[0,3],content:o.jsxs(o.Fragment,{children:["Show History(",o.jsx("code",{children:"Ctrl"})," + ",o.jsx("code",{children:"H"}),")"]}),onClick:()=>{var n;return(n=t.current)==null?void 0:n.open()},children:o.jsx("div",{className:"cldr codicon codicon-history"})})]})}const A="ppd-bottom-status";function G(){const{plugins:t,...e}=React.useContext(S),s=React.useMemo(()=>t.filter(i=>{var r;return(r=i.editor)==null?void 0:r.statusbar}).flatMap(i=>{var r;return((r=i.editor)==null?void 0:r.statusbar)??[]}),[t]);return o.jsxs("div",{className:`monaco-editor ${A}`,children:[o.jsx(F,{}),o.jsx(T,{}),o.jsx(B,{}),s.map((i,r)=>o.jsx(i,{...e},r))]})}function K(t){if(t===void 0)return[!0,!0,!0,!0];if(t===!1)return[!1,!1,!1,!1];if(Array.isArray(t)){const[e,s,i,r]=t;return[e??!1,s??!1,i??!1,r??!1]}if(typeof t=="object"){const{left:e,right:s,top:i,bottom:r}=t;return[e??!1,s??!1,i??!1,r??!1]}return[!1,!1,!1,!1]}const l="ppd-resizable";function q(t){const e={get MIN_WIDTH(){return getComputedStyle(t,"").getPropertyValue("min-width")},get MIN_HEIGHT(){return getComputedStyle(t,"").getPropertyValue("min-height")}};let s,i=!1;function r(d,a,v){const[g,m]=[d?"y":"x",d?"height":"width"],R=v[g]-s,j=parseInt(getComputedStyle(t,"")[m])+R*a;s=v[g],t.style[m]=j+"px"}const n=[];function p(d){var u,c,f,h;const a=d.target,[v,g,m,R]=[(u=a==null?void 0:a.classList)==null?void 0:u.contains(`${l}-border__left`),(c=a==null?void 0:a.classList)==null?void 0:c.contains(`${l}-border__right`),(f=a==null?void 0:a.classList)==null?void 0:f.contains(`${l}-border__top`),(h=a==null?void 0:a.classList)==null?void 0:h.contains(`${l}-border__bottom`)],[j,b]=[v||g,m||R];if(!j&&!b)return;s=j?d.pageX:d.pageY,i?(j&&(t.style.width=e.MIN_WIDTH),b&&(t.style.height=e.MIN_HEIGHT)):(i=!0,setTimeout(()=>i=!1,1e3)),document.querySelectorAll("iframe").forEach(C=>C.style.pointerEvents="none");const _=r.bind(null,b,g||R?1:-1);n.push(_),document.addEventListener("mousemove",_,!1),t.style.userSelect="none"}function x(){n.forEach(d=>document.removeEventListener("mousemove",d,!1)),document.querySelectorAll("iframe").forEach(d=>d.style.pointerEvents="auto"),t.style.userSelect="auto"}return t.addEventListener("mousedown",p,!1),document.addEventListener("mouseup",x),()=>{t.removeEventListener("mousedown",p),document.removeEventListener("mouseup",x)}}function O({className:t,style:e,children:s,...i}){const r=React.useRef(null),[n,p,x,d]=K(i.resizable);React.useEffect(()=>{r.current!==null&&(x===!1||d===!1)&&(r.current.style.height=typeof(e==null?void 0:e.height)=="number"?e.height+"px":(e==null?void 0:e.height)??"auto")},[x,d,e==null?void 0:e.height]),React.useEffect(()=>{r.current!==null&&(n===!1||p===!1)&&(r.current.style.width=typeof(e==null?void 0:e.width)=="number"?e.width+"px":(e==null?void 0:e.width)??"auto")},[n,p,e==null?void 0:e.width]);const a=React.useRef();return o.jsxs("div",{className:E(l,t,n&&`${l}__left`,p&&`${l}__right`,x&&`${l}__top`,d&&`${l}__bottom`),style:e,ref:async v=>{var g;if(!v){(g=a.current)==null||g.call(a);return}r.current=v,a.current=q(v)},children:[s,n&&o.jsx("div",{className:`${l}-border ${l}-border__left`}),p&&o.jsx("div",{className:`${l}-border ${l}-border__right`}),x&&o.jsx("div",{className:`${l}-border ${l}-border__top`}),d&&o.jsx("div",{className:`${l}-border ${l}-border__bottom`})]})}const U="ppd-top-bar";function W({className:t}){const{plugins:e,...s}=React.useContext(S),i=React.useMemo(()=>e.filter(r=>{var n;return(n=r.editor)==null?void 0:n.topbar}).flatMap(r=>{var n;return((n=r.editor)==null?void 0:n.topbar)??[]}),[e]);return o.jsx("div",{className:E(U,t),children:i.map((r,n)=>o.jsx(r,{...s},n))})}const N="ppd-editor-zone";function Q(t){const{enableMenuSwitch:e=!0}=t,s=React.useRef(new URLSearchParams(location.search)),[i,r]=React.useState(null),n=React.useMemo(()=>Object.values(t.plugins??{}).filter(u=>!!u),[t.plugins]),p=n.reduce((u,c)=>{var f,h;return{...u,...(h=(f=c.editor)==null?void 0:f.use)==null?void 0:h.reduce((C,$)=>({...C,...$==null?void 0:$({searchParams:s.current,editor:i})}),{})}},{}),{code:x,setCode:d,loadingNode:a,curFilePath:v,language:g}=p;if(d===void 0)throw new Error("You must register a plugin to provide `setCode` function");const m=P();React.useEffect(()=>{if(!m)return;try{m.editor.addKeybindingRule({keybinding:m.KeyMod.CtrlCmd|m.KeyMod.Shift|m.KeyCode.KeyP,command:"editor.action.quickCommand"})}catch(c){console.error(c)}const u=n.map(c=>{var f,h;return(h=(f=c==null?void 0:c.editor)==null?void 0:f.preload)==null?void 0:h.call(f,m)});return()=>u.forEach(c=>c==null?void 0:c())},[m,n]),n.forEach(u=>{var c,f;return(f=(c=u==null?void 0:u.editor)==null?void 0:c.useShare)==null?void 0:f.call(c,p,m)});const[R,j]=React.useState("light");React.useEffect(()=>onThemeChange(j),[]);const[b,_]=D(I);return o.jsx(S.Provider,{value:{searchParams:s.current,plugins:n,shareState:p},children:o.jsx(w.Provider,{value:{monaco:m,editorInstance:i,store:{code:[x,d],theme:[R,j]}},children:o.jsxs(O,{className:E(N,t.className),style:{...t.style,width:"var(--editor-width, 50%)",minWidth:"var(--editor-min-width)",maxWidth:"var(--editor-max-width)",height:"var(--editor-height, 50%)",minHeight:"var(--editor-min-height)",maxHeight:"var(--editor-max-height)"},resizable:t.resizable??{right:!0},children:[e&&o.jsx("div",{className:E(`${N}__menu-switch`,{"is-active":b}),title:"display left zone.",onClick:()=>_(!b),children:o.jsx("div",{className:"cldr codicon codicon-menu"})}),b&&o.jsx(k,{}),o.jsxs("div",{className:`${N}__container`,children:[o.jsx(W,{className:e&&b?"is-active":void 0}),a??o.jsx(y,{language:g,options:{automaticLayout:!0,scrollbar:{vertical:"hidden",verticalSliderSize:0,verticalScrollbarSize:0}},theme:R==="light"?"vs":"vs-dark",loading:a,path:`file://${v}`,value:x,onChange:u=>d(u??""),onMount:(u,c)=>{n.forEach(f=>{var h,C;return(C=(h=f.editor)==null?void 0:h.load)==null?void 0:C.call(h,u,c)}),r(u),u.focus()}}),o.jsx(G,{})]})]})})})}function ee(t){return t}export{Q as E,ee as d};
