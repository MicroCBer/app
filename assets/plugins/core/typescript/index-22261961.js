import{_ as $,e as w,j as o,d as F}from"../../../index-c550fbfb.js";import{l as A,Q as k,m as D,g as I,b as C}from"../../../messenger-provider-aedd2154.js";import{P as L}from"../../../Popover-625761fc.js";import{u as R}from"../../../react-cb7e9860.js";function N(e){if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1,t=arguments.length;r<t;){var u=arguments[r];if(u!=null)for(var l in u)$(l,u)&&(n[l]=u[l]);r+=1}return n}const W=typeof Object.assign=="function"?Object.assign:N;var z=w(function(n){return W.apply(null,[{}].concat(n))});const q=z;const m="ppd-switcher";function U(e){const{value:n,onChange:r}=e,t=React.useRef([]),[u,l]=React.useState(0),p=c=>{n!==c&&r(c),l(t.current[c?0:1])};return o.jsxs("div",{className:m,style:e.style,children:[o.jsx("div",{ref:c=>(t.current[0]=(c==null?void 0:c.offsetWidth)||0,p(n)),className:`${m}__item`,onClick:()=>p(!0),children:e.rText}),o.jsx("div",{ref:c=>(t.current[1]=(c==null?void 0:c.offsetWidth)||0,p(n)),className:`${m}__item`,onClick:()=>p(!1),children:e.lText}),o.jsx("div",{className:`${m}__item--bar`,style:{transform:`translateX(calc(${n?0:t.current[0]??0}px + var(--gap) * ${n?0:1}))`,width:u}})]})}const H=({shareState:e})=>{const{language:n,changeLanguage:r}=e,t=26,u={display:"flex",alignItems:"center",justifyContent:"center"},l=o.jsx("span",{style:u,children:o.jsx("img",{width:t,alt:"typescript",src:"https://cdn.jsdelivr.net/gh/devicons/devicon/icons/typescript/typescript-original.svg"})}),p=o.jsx("span",{style:u,children:o.jsx("img",{width:t,alt:"javascript",src:"https://cdn.jsdelivr.net/gh/devicons/devicon/icons/javascript/javascript-original.svg"})});return o.jsx(U,{style:{"--gap":"0px","--bor-size":"3px",order:-100,alignSelf:"end"},lText:l,rText:p,value:n==="javascript",onChange:c=>r==null?void 0:r(c?"javascript":"typescript")})},Q=[({searchParams:e,editor:n})=>{const[r,t]=React.useState(),u=React.useRef(!0),l=React.useCallback(d=>{A.config({paths:{vs:`https://typescript.azureedge.net/cdn/${d}/monaco/min/vs`}}),t(d),e.set("typescript",d);const y=n==null?void 0:n.getValue(),j=y?"#"+btoa(encodeURIComponent(y)):location.hash;history.replaceState(null,"","?"+e.toString()+j),u.current?u.current=!1:location.reload()},[n,e]),[p,c]=React.useState(e.get("lang")==="javascript"?"javascript":"typescript");function i(d){c(d),e.set("lang",d),history.replaceState(null,"","?"+e.toString()+location.hash)}const g=React.useMemo(()=>`/index.${p==="javascript"?"js":"ts"}`,[p]),[a,f]=React.useState();React.useEffect(()=>{function d(y){y.target instanceof HTMLScriptElement&&y.target.src.startsWith("https://typescript.azureedge.net/cdn/")&&f(`TypeScript@${r} unavailable`)}return addEventListener("error",d,!0),()=>removeEventListener("error",d)},[r]);const x=React.useMemo(()=>r?null:o.jsxs("section",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[o.jsx("div",{style:{position:"relative",width:72,height:72,backgroundColor:"#4272ba",userSelect:"none"},children:o.jsx("span",{style:{position:"absolute",right:5,bottom:-2,fontSize:30,fontWeight:"blob"},children:"TS"})}),a?o.jsx("span",{children:a}):o.jsxs("span",{children:["Downloading TypeScript",r&&o.jsxs(o.Fragment,{children:["@",o.jsx("code",{children:r})]})," ..."]})]}),[a,r]);return{curFilePath:g,typescriptVersion:r,changeTypescriptVersion:l,language:p,changeLanguage:i,loadingNode:x}}],v={distCategory:["latest","next","beta","rc","insiders","tag-for-publishing-older-releases","dev"],distTagEnum:{latest:"5.1.6","5.1.6":"latest",next:"5.3.0-dev.20230818","5.3.0-dev.20230818":"next",beta:"5.2.0-beta","5.2.0-beta":"beta",rc:"5.2.1-rc","5.2.1-rc":"rc",insiders:"4.6.2-insiders.20220225","4.6.2-insiders.20220225":"insiders","tag-for-publishing-older-releases":"4.1.6","4.1.6":"tag-for-publishing-older-releases",dev:"3.9.4","3.9.4":"dev"},versions:["5.1.6","5.0.4","4.9.5","4.8.4","4.7.4","4.6.4","4.5.5","4.4.4","4.3.5","4.2.4","4.1.6","4.0.8","3.9.10","3.8.3","3.7.7","3.6.5","3.5.3","3.4.5","3.3.4000","5.1.6","5.3.0-dev.20230818","5.2.0-beta","5.2.1-rc","4.6.2-insiders.20220225","4.1.6","3.9.4"],suggestedVersions:["5.1.6","5.0.4","4.9.5","4.8.4","4.7.4","4.6.4","4.5.5","4.4.4","4.3.5","4.2.4","4.1.6","4.0.8","3.9.10","3.8.3","3.7.7","3.6.5","3.5.3","3.4.5","3.3.4000"]},X=()=>{const[e,n]=React.useState(0),[r,t]=React.useState(!1),[u,l]=React.useState(null),[p,c]=React.useState(),i=React.useRef(new AbortController),g=React.useRef(!1);return React.useEffect(()=>{if(!g.current){g.current=!0;return}return r||(t(!0),fetch("https://registry.npmmirror.com/-/package/typescript/dist-tags",{signal:i.current.signal}).then(a=>a.json()).then(a=>{c(a),l(null)}).catch(l).finally(()=>{t(!1),i.current=new AbortController})),()=>i.current.abort()},[i,r,e]),{data:p,fetching:r,error:u,reFetch:()=>n(e+1)}},B=({searchParams:e,shareState:n})=>{const r=e.get("typescript")??e.get("ts")??e.get("tsv")??e.get("tsv"),t=e.get("tag")??e.get("dist-tag")??e.get("distTag")??e.get("dist_tag")??r,{data:u,fetching:l,error:p}=X(),c=React.useMemo(()=>p!==null&&u?u:null,[u,p]),i=React.useMemo(()=>c?Object.fromEntries(Object.entries(c).flatMap(([s,h])=>[[s,h],[h,s]])):v.distTagEnum,[c]),g=React.useMemo(()=>c?Object.keys(c):v.distCategory,[c]),a=React.useMemo(()=>n.typescriptVersion??(r!==null&&v.suggestedVersions.includes(r)?r:t?i[t]:v.versions[0]),[i,t,r,n.typescriptVersion]),f=n.changeTypescriptVersion,x=React.useMemo(()=>a===void 0?!1:v.suggestedVersions.indexOf(a)===-1,[a]),d=React.useMemo(()=>{if(a!==void 0)return x?i==null?void 0:i[a]:a},[i,x,a]),y=React.useRef(!1);React.useEffect(()=>{if(d!==void 0){if(y.current)return;y.current=!0,f==null||f(d)}},[f,d]);const j=React.useContext(k),M=React.useMemo(()=>v.suggestedVersions.map(s=>{const h=(s==="3.3.3333"?"3.3.3":s==="3.3.4000"?"3.3.4":s)+(i[s]?` (${i[s]})`:"");return{id:s,value:i[s]??s,title:h}}),[i]),T=React.useMemo(()=>g.map(s=>({id:s,value:i[s]??s,title:`${s} (${i[s]})`})),[g,i]),V=React.useMemo(()=>{let s;return l?s=()=>[{id:"fetching",title:"Fetching..."}]:s=h=>M.concat(T).filter(({title:_})=>!h||_.includes(h)),s.defaultId=v.suggestedVersions.includes(a)?a:i[a]??a,s.options={placeholder:"Select TypeScript Version"},s},[i,l,M,T,a]);return React.useEffect(()=>j.register("typescript.versions",V),[j,V]),o.jsxs(L,{content:o.jsxs(o.Fragment,{children:["Monaco Editor is using TypeScript@",i[a]??a," as language service.(Click to change version)"]}),style:{cursor:"pointer",userSelect:"none"},offset:[0,3],onClick:async()=>{try{const s=await j.run("typescript.versions");"id"in s&&(s.value?f==null||f(s.value.toString()):D.then(h=>h.display("error",o.jsxs(o.Fragment,{children:[o.jsx("h3",{children:"Invalid TypeScript Version"}),o.jsxs("p",{children:["Version ",o.jsx("code",{children:s.id})," is not available."]}),o.jsxs("p",{children:["Click ",o.jsx("a",{href:"/TODO",children:"it"})," and find help."]})]})))),"text"in s&&console.log("text",s)}catch(s){console.error(s)}},children:["TypeScript@",a]})},b=I(),S=C({target:4,moduleResolution:2,declaration:!0,lib:["esnext","dom","esnext.disposable"]}),E=C([]),O=C([]),G={use:Q,useShare({curFilePath:e,language:n,typescriptVersion:r},t){const[u]=R(S),l=React.useMemo(()=>{if(!(!t||!r))return n==="javascript"?t.languages.typescript.javascriptDefaults:t.languages.typescript.typescriptDefaults},[n,t,r]);React.useEffect(()=>{!l||!t||(l.setCompilerOptions({...l.getCompilerOptions(),...u}),console.group("monaco detail data"),console.log("typescript.version",t.languages.typescript.typescriptVersion),console.log("typescript.CompilerOptions",t.languages.typescript.typescriptDefaults.getCompilerOptions()),console.groupEnd())},[u,l,t]);const[p]=R(E),[c]=R(O);React.useEffect(()=>{if(!(!l||!t))return p.forEach(({content:i,filePath:g})=>{t.editor.createModel(i,n==="javascript"?"javascript":"typescript",t.Uri.parse(g))}),c.forEach(({content:i,filePath:g})=>{t.editor.createModel(i,n==="javascript"?"javascript":"typescript",t.Uri.parse(`file:///node_modules/${g}`))}),()=>{t.editor.getModels().forEach(i=>{i.uri.path!==e&&i.dispose()})}},[t,e,n,l,p,c])},topbar:[H],statusbar:[B]},P=F("typescript",e=>(e!=null&&e.compilerOptions&&b.set(S,q([S.init,e.compilerOptions])),e!=null&&e.extraFiles&&b.set(E,e.extraFiles),e!=null&&e.extraModules&&b.set(O,e.extraModules),{editor:G}));export{P as _};
